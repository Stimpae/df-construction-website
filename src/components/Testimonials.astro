---
import TestimonialCard from './TestimonialCard.astro';
import { getCollection } from 'astro:content';

// Fetch testimonials from the content collection
const allTestimonials = await getCollection('testimonials');

// Filter to get only featured testimonials (max 3)
const featuredTestimonials = allTestimonials
  .filter(testimonial => testimonial.data.featured === true)
  .slice(0, 3)
  .map(testimonial => ({
    name: testimonial.data.name,
    position: testimonial.data.position,
    company: testimonial.data.company,
    testimonial: testimonial.data.testimonial,
    rating: testimonial.data.rating,
    image: testimonial.data.image
  }));

// If there are no featured testimonials yet, use these placeholders
const fallbackTestimonials = featuredTestimonials.length ? [] : [
  {
    name: "Sarah Johnson",
    position: "Homeowner",
    testimonial: "Working with this construction company was a wonderful experience. They transformed our backyard with beautiful brickwork that has become the highlight of our outdoor space. Their attention to detail was impressive.",
    rating: 5
  },
  {
    name: "Michael Roberts",
    position: "Project Manager",
    company: "Roberts Real Estate",
    testimonial: "We've worked with many contractors over the years, but this team stands out for their professionalism and quality. The brickwork on our commercial property was completed on time and within budget.",
    rating: 5
  },
  {
    name: "Emily Williams",
    position: "Architect",
    company: "Williams & Associates",
    testimonial: "As an architect, I have high standards for the execution of my designs. This company consistently delivers exceptional craftsmanship that brings our visions to life. Highly recommended!",
    rating: 4
  }
];

// Use actual testimonials if available, otherwise use fallbacks
const testimonialsToDisplay = featuredTestimonials.length ? featuredTestimonials : fallbackTestimonials;
---

<section id="testimonials" class="py-20 bg-primary">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center mb-16">
      <p class="text-secondary font-medium mb-2">WHAT CLIENTS SAY</p>
      <h2 class="text-3xl md:text-4xl font-bold text-white font-heading mb-6">CLIENT<br>TESTIMONIALS</h2>
      <p class="text-gray-300 max-w-2xl mx-auto mb-8">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
      </p>
    </div>
    
    <!-- Testimonials Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {testimonialsToDisplay.map(testimonial => (
        <TestimonialCard
          name={testimonial.name}
          position={testimonial.position}
          company={testimonial.company}
          testimonial={testimonial.testimonial}
          rating={testimonial.rating}
          image={testimonial.image}
        />
      ))}
    </div>
  </div>
</section>